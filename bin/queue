#!/usr/bin/env php
<?php

declare(strict_types=1);

use Psr\Log\LoggerInterface;
use Symfony\Component\Console\Application;
use Yiisoft\Di\Container;
use Yiisoft\Di\ContainerConfig;

$vendorPath = null;

$composerAutoload = [
    __DIR__ . '/../vendor/autoload.php', // in yii2-dev repo
    __DIR__ . '/../../autoload.php', // installed as a composer binary
];

foreach ($composerAutoload as $autoload) {
    if (file_exists($autoload)) {
        require_once $autoload;

        $vendorPath = dirname($autoload);

        break;
    }
}

if ($vendorPath === null) {
    fwrite(STDERR, 'Can not find vendor/autoload.php' . PHP_EOL);
    exit(1);
}

/** @var array $definitions */
$definitions = require_once 'definitions.php';

$containerConfig = ContainerConfig::create()->withDefinitions($definitions);
$container = new Container($containerConfig);

if ($container->has(LoggerInterface::class) === false) {
    throw new RuntimeException(
        'Logger is not configured, install your logger of choice and configure it properly in /bin/definitions.php.'
    );
}

/** @var Application $application */
$application = $container->get(Application::class);
$application->run();
